<?php

$c_handle = application::singular("category", application::get("permalink", "uncategorized", REQ_STRING));
$start_from = application::get("start", 0, REQ_INT);
$items_limit = 10;
$max_info_length = 512;
?>
<div class="page-stream-list -limit-width">
    <h1>STREAMS IN "<?= htmlspecialchars(strtoupper($c_handle->getName())) ?>" CATEGORY</h1>
    <ul class="page-stream-list-list _ajax-upload-subject">
<?php 
$streams = $c_handle->getStreams($start_from, $items_limit);  
$tmpl = new template("application/tmpl/us.streamitem.tmpl");
foreach($streams as $stream):
    $tmpl->reset();
    $tmpl->addVariable("stream_id", $stream['sid']);
    $tmpl->addVariable("stream_url", stream::staticStreamLink($stream));
    $tmpl->addVariable("stream_title", strtoupper($stream['name']));
    $tmpl->addVariable("stream_info", (strlen($stream['info']) < $max_info_length) ? ($stream['info']) : (substr($stream['info'], 0, $max_info_length) . "..."));
    $tmpl->addVariable("stream_hashtags", layout::parseHashTags($stream['genres']), true);
    echo $tmpl->makeDocument();
endforeach; ?>
    </ul>
</div>