<?php

/* 
    myownradio.biz module
    section : user-size
    action  : getting list of streams by search query
*/

$start_from = application::get("start", 0, REQ_INT);
$search_filter = application::get("q", "", REQ_STRING);
$items_limit = 10;
$max_info_length = 512;
?>
<div class="page-stream-list -limit-width">
    <h1>FOUND RESULTS FOR "<?= htmlspecialchars(strtoupper($search_filter)); ?>" <a class="Clear Results" href="/browse">[CLEAR]</a></h1>
    <ul class="page-stream-list-list _ajax-upload-subject">
<?php 
$streams = stream::streamSearch(misc::searchQueryFilter($search_filter), $start_from, $items_limit);  
$tmpl = new template("application/tmpl/us.streamitem.tmpl");
foreach($streams as $stream): 
    $tmpl->reset();
    $tmpl->addVariable("stream_id", $stream['sid']);
    $tmpl->addVariable("stream_url", stream::staticStreamLink($stream));
    $tmpl->addVariable("stream_title", strtoupper($stream['name']));
    $tmpl->addVariable("stream_info", (strlen($stream['info']) < $max_info_length) ? ($stream['info']) : (substr($stream['info'], 0, $max_info_length) . "..."));
    $tmpl->addVariable("stream_hashtags", layout::parseHashTags($stream['genres']), true);
    echo $tmpl->makeDocument();
endforeach; ?>
    </ul>
<?php $count = count($streams); if($count === 0): ?>
    <div class="page-stream-no-results">No results</div>
<?php endif; ?>
</div>