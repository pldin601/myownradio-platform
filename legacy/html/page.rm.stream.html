<?php
if (!isset($_MODULE['stream_id'])) 
{ 
    header("Location: /radiomanager"); 
    return; 
}

try
{
    $stream = application::singular("stream", $_MODULE['stream_id']);
}
catch(Exception $e)
{
    header("Location: /radiomanager"); 
    return;
}

if ($stream->getOwner() != user::getCurrentUserId()) 
{ 
    header("Location: /radiomanager"); 
    return; 
}
?>
<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title><?= htmlspecialchars($stream->getStreamName()); ?> @ My Own Radio Manager</title>
        <!-- module:rm.common -->
        <!-- include:css -->
        <!-- include:js -->
        <script type="text/javascript">var active_stream = <?= json_encode(array(
            'stream_id'             => (int) $stream->getStreamId(),
            'tracks_count'          => (int) $stream->getTracksCount(),
            'tracks_duration'       => (int) $stream->getDuration(),
            'stream_link'           => $stream->getStreamLink()
        )); ?></script>
    </head>
    <body class="partial stream">
        <div id="jplayer"></div>
        <!-- module:rm.header -->
        <div class="rm_body_wrap rm_max_width">
            <!-- module:rm.sidebar -->
            <div class="rm_content_wrap">
                <!-- module:rm.stream.status -->
                <div class="rm_tracks_data" content="<?= base64_encode(json_encode($stream->dbGetStreamTracks(0, config::getSetting("json", "tracks_per_query"))))?>"></div>
                <!-- module:rm.tracklist -->
            </div>
        </div>
    </body>
</html>